(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[415],{38041:(e,s,r)=>{Promise.resolve().then(r.bind(r,62234))},62234:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>o});var t=r(95155),a=r(12115),l=r(35695),n=r(29911),i=r(13568);function o(){let e=(0,l.useRouter)(),{id:s}=(0,l.useParams)(),[r,o]=(0,a.useState)({name:"",age:"",sexe:"",diagnosis:"",poids:"",taille:"",traitement:"",numSecu:"",medecin:"",allergies:"",groupeSanguin:""}),[c,u]=(0,a.useState)(!0),[d,m]=(0,a.useState)(!1),[x,g]=(0,a.useState)({}),[p,b]=(0,a.useState)({}),[h,f]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{var r,a,l;u(!0);let e=await fetch("/api/patients/".concat(s));if(!e.ok){let s=await e.json();throw Error(s.error||"Erreur lors de la r\xe9cup\xe9ration des donn\xe9es")}let t=await e.json();o({name:t.name||"",age:(null==(r=t.age)?void 0:r.toString())||"",sexe:t.sexe||"",diagnosis:t.diagnosis||"",poids:(null==(a=t.poids)?void 0:a.toString())||"",taille:(null==(l=t.taille)?void 0:l.toString())||"",traitement:t.traitement||"",numSecu:t.numSecu||"",medecin:t.medecin||"",allergies:t.allergies||"",groupeSanguin:t.groupeSanguin||""})}catch(r){console.error("Erreur chargement patient:",r);let s=r instanceof Error?r.message:"Erreur inconnue";i.oR.error(s,{icon:(0,t.jsx)(n.BS8,{className:"text-red-500"})}),e.push("/patients")}finally{u(!1)}})()},[s,e]);let j=(e,s)=>{let r="";switch(e){case"name":s.trim()?s.length<2&&(r="Le nom doit contenir au moins 2 caract\xe8res"):r="Le nom est requis";break;case"age":s?isNaN(Number(s))?r="L'\xe2ge doit \xeatre un nombre":(0>parseInt(s)||parseInt(s)>120)&&(r="L'\xe2ge doit \xeatre entre 0 et 120"):r="L'\xe2ge est requis";break;case"numSecu":s&&!/^\d{13,15}$/.test(s)&&(r="Doit contenir 13 \xe0 15 chiffres");break;case"taille":s&&(isNaN(Number(s))||.5>parseFloat(s)||parseFloat(s)>2.5)&&(r="La taille doit \xeatre entre 0.5 et 2.5 m\xe8tres");break;case"poids":s&&(isNaN(Number(s))||1>parseFloat(s)||parseFloat(s)>300)&&(r="Le poids doit \xeatre entre 1 et 300 kg");break;case"diagnosis":s.trim()||(r="Le diagnostic est requis")}return r},N=e=>{let{name:s}=e.target;b(e=>({...e,[s]:!0})),"numSecu"===s&&r.numSecu&&r.numSecu!=r.numSecu&&v(r.numSecu);let t=j(s,r[s]);g(e=>({...e,[s]:t}))},v=async e=>{try{let r=await fetch("/api/patients/check-numsecu?numSecu=".concat(e,"&excludeId=").concat(s));(await r.json()).exists?(g(e=>({...e,numSecu:"Ce num\xe9ro de s\xe9curit\xe9 sociale est d\xe9j\xe0 utilis\xe9"})),f(!0)):(f(!1),"Ce num\xe9ro de s\xe9curit\xe9 sociale est d\xe9j\xe0 utilis\xe9"===x.numSecu&&g(e=>({...e,numSecu:""})))}catch(e){console.error("Erreur v\xe9rification numSecu:",e)}},y=e=>{let{name:s,value:r}=e.target;if(o(e=>({...e,[s]:r})),p[s]){let e=j(s,r);g(r=>({...r,[s]:e}))}},w=async a=>{a.preventDefault(),m(!0);let l={};if(Object.keys(r).forEach(e=>{"numSecu"===e&&r[e]&&h?l[e]="Ce num\xe9ro de s\xe9curit\xe9 sociale est d\xe9j\xe0 utilis\xe9":l[e]=j(e,r[e])}),g(l),b(Object.keys(r).reduce((e,s)=>({...e,[s]:!0}),{})),Object.values(l).some(e=>e)){i.oR.error("Veuillez corriger les erreurs avant de soumettre",{icon:(0,t.jsx)(n.BS8,{className:"text-red-500"})}),m(!1);return}try{let a=await fetch("/api/patients/".concat(s),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...r,age:r.age?parseInt(r.age):null,poids:r.poids?parseFloat(r.poids):null,taille:r.taille?parseFloat(r.taille):null})}),l=await a.json();if(!a.ok)throw Error(l.error||"\xc9chec de la mise \xe0 jour");i.oR.success("Modifications enregistr\xe9es avec succ\xe8s!",{duration:4e3,position:"top-center",icon:(0,t.jsx)(n.A7C,{className:"text-green-500"})}),e.push("/patients/?updated=true")}catch(s){console.error("Erreur mise \xe0 jour:",s);let e=s instanceof Error?s.message:"Erreur inconnue";i.oR.error(e,{icon:(0,t.jsx)(n.BS8,{className:"text-red-500"})})}finally{m(!1)}};return c?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 p-4 md:p-8 text-black",children:[(0,t.jsx)(i.l$,{}),(0,t.jsxs)("div",{className:"max-w-6xl mx-auto bg-white rounded-xl shadow-md overflow-hidden",children:[(0,t.jsx)("div",{className:"bg-blue-700 p-6 text-white",children:(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Modification du dossier patient"})}),(0,t.jsxs)("form",{onSubmit:w,className:"p-6 space-y-8",children:[(0,t.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-blue-50 p-4 border-b flex items-center",children:[(0,t.jsx)(n.x$1,{className:"text-blue-700 mr-2"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-blue-800",children:"Informations personnelles"})]}),(0,t.jsxs)("div",{className:"p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nom complet*"}),(0,t.jsx)("input",{type:"text",name:"name",value:r.name,onChange:y,onBlur:N,required:!0,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(p.name&&x.name?"border-red-500":"")}),p.name&&x.name&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:x.name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\xc2ge*"}),(0,t.jsx)("input",{type:"number",name:"age",value:r.age,onChange:y,onBlur:N,required:!0,min:"0",max:"120",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(p.age&&x.age?"border-red-500":"")}),p.age&&x.age&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:x.age})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sexe"}),(0,t.jsxs)("select",{name:"sexe",value:r.sexe,onChange:y,onBlur:N,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,t.jsx)("option",{value:"",children:"S\xe9lectionner"}),(0,t.jsx)("option",{value:"M",children:"Masculin"}),(0,t.jsx)("option",{value:"F",children:"F\xe9minin"}),(0,t.jsx)("option",{value:"Autre",children:"Autre"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xb0 S\xe9curit\xe9 Sociale"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(n.AWX,{className:"absolute left-3 top-3 text-gray-400"}),(0,t.jsx)("input",{type:"text",name:"numSecu",value:r.numSecu,onChange:y,onBlur:N,pattern:"[0-9]{13,15}",title:"Doit contenir 13 \xe0 15 chiffres",className:"w-full pl-10 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(p.numSecu&&x.numSecu?"border-red-500":"")})]}),p.numSecu&&x.numSecu&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:x.numSecu})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Groupe sanguin"}),(0,t.jsxs)("select",{name:"groupeSanguin",value:r.groupeSanguin,onChange:y,onBlur:N,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,t.jsx)("option",{value:"",children:"Inconnu"}),(0,t.jsx)("option",{value:"A+",children:"A+"}),(0,t.jsx)("option",{value:"A-",children:"A-"}),(0,t.jsx)("option",{value:"B+",children:"B+"}),(0,t.jsx)("option",{value:"B-",children:"B-"}),(0,t.jsx)("option",{value:"AB+",children:"AB+"}),(0,t.jsx)("option",{value:"AB-",children:"AB-"}),(0,t.jsx)("option",{value:"O+",children:"O+"}),(0,t.jsx)("option",{value:"O-",children:"O-"})]})]})]})]}),(0,t.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-blue-50 p-4 border-b flex items-center",children:[(0,t.jsx)(n.Ax7,{className:"text-blue-700 mr-2"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-blue-800",children:"Informations m\xe9dicales"})]}),(0,t.jsxs)("div",{className:"p-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Taille (m)"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(n.GtC,{className:"absolute left-3 top-3 text-gray-400"}),(0,t.jsx)("input",{type:"number",name:"taille",value:r.taille,onChange:y,onBlur:N,step:"0.01",min:"0.5",max:"2.5",className:"w-full pl-10 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(p.taille&&x.taille?"border-red-500":"")})]}),p.taille&&x.taille&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:x.taille})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Poids (kg)"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(n.egb,{className:"absolute left-3 top-3 text-gray-400"}),(0,t.jsx)("input",{type:"number",name:"poids",value:r.poids,onChange:y,onBlur:N,step:"0.1",min:"1",max:"300",className:"w-full pl-10 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(p.poids&&x.poids?"border-red-500":"")})]}),p.poids&&x.poids&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:x.poids})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"M\xe9decin traitant"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(n.ifA,{className:"absolute left-3 top-3 text-gray-400"}),(0,t.jsx)("input",{type:"text",name:"medecin",value:r.medecin,onChange:y,onBlur:N,className:"w-full pl-10 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Allergies connues"}),(0,t.jsx)("textarea",{name:"allergies",value:r.allergies,onChange:y,onBlur:N,rows:3,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Diagnostic principal*"}),(0,t.jsx)("textarea",{name:"diagnosis",value:r.diagnosis,onChange:y,onBlur:N,required:!0,rows:3,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(p.diagnosis&&x.diagnosis?"border-red-500":"")}),p.diagnosis&&x.diagnosis&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:x.diagnosis})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Traitement prescrit"}),(0,t.jsx)("textarea",{name:"traitement",value:r.traitement,onChange:y,onBlur:N,rows:4,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-4 pt-4",children:[(0,t.jsxs)("button",{type:"button",onClick:()=>{window.confirm("Voulez-vous vraiment annuler les modifications non enregistr\xe9es ?")&&e.push("/patients")},disabled:d,className:"px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition flex items-center disabled:opacity-50",children:[(0,t.jsx)(n.QCr,{className:"mr-2"}),"Annuler"]}),(0,t.jsx)("button",{type:"submit",disabled:d||Object.values(x).some(e=>e),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center ".concat(d||Object.values(x).some(e=>e)?"opacity-50 cursor-not-allowed":""),children:d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Enregistrement..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.dIn,{className:"mr-2"}),"Enregistrer"]})})]})]})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[711,607,441,684,358],()=>s(38041)),_N_E=e.O()}]);