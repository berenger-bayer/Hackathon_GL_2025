{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/macuser/Documents/GitHub/Hackathon_GL_2025/app/patients/%5Bid%5D/completer/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useParams, useRouter } from \"next/navigation\";\nimport { FaArrowLeft, FaSave, FaExclamationCircle } from \"react-icons/fa\";\n\ntype Patient = {\n  id: string;\n  name: string;\n  age: number;\n  diagnosis: string;\n  poids: number | null;\n  taille: number | null;\n  traitement: string | null;\n  numSecu: string | null;\n  medecin: string | null;\n  createdAt: string;\n};\n\nexport default function CompleterDossierPatient() {\n  const { id } = useParams();\n  const router = useRouter();\n  const [patient, setPatient] = useState<Patient | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [formErrors, setFormErrors] = useState<{[key: string]: string}>({});\n\n  useEffect(() => {\n    if (!id) return;\n\n    fetch(`/api/patients/${id}`)\n      .then(async (res) => {\n        if (!res.ok) throw new Error(`Erreur API: ${res.status}`);\n        const data = await res.json();\n        setPatient(data);\n        setLoading(false);\n      })\n      .catch((err) => {\n        console.error(\"Erreur chargement patient:\", err);\n        setError(\"Impossible de charger les informations du patient\");\n        setLoading(false);\n      });\n  }, [id]);\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\n    const { name, value, type } = e.target as HTMLInputElement;\n    \n    if (!patient) return;\n    \n    let parsedValue: any = value;\n    \n    // Convertir les valeurs numériques\n    if (type === 'number') {\n      parsedValue = value ? parseFloat(value) : null;\n    }\n    \n    setPatient({ ...patient, [name]: parsedValue });\n    \n    // Effacer l'erreur pour ce champ si elle existe\n    if (formErrors[name]) {\n      setFormErrors({...formErrors, [name]: ''});\n    }\n  };\n\n  const validateForm = (): boolean => {\n    const errors: {[key: string]: string} = {};\n    \n    // Validation basique\n    if (patient?.poids && patient.poids <= 0) errors.poids = \"Le poids doit être supérieur à 0\";\n    if (patient?.taille && patient.taille <= 0) errors.taille = \"La taille doit être supérieure à 0\";\n    if (patient?.numSecu && !/^\\d{13,15}$/.test(patient.numSecu)) {\n      errors.numSecu = \"Le numéro de sécurité sociale doit contenir entre 13 et 15 chiffres\";\n    }\n    \n    setFormErrors(errors);\n    return Object.keys(errors).length === 0;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!patient || !id) return;\n    \n    if (!validateForm()) {\n      return;\n    }\n    \n    setSaving(true);\n    \n    try {\n      const response = await fetch(`/api/patients/${id}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(patient),\n      });\n\n      if (!response.ok) {\n        throw new Error(`Erreur lors de la sauvegarde: ${response.status}`);\n      }\n\n      // Rediriger vers la fiche médicale après la mise à jour réussie\n      router.push(`/patients/dossier/${id}`);\n      \n    } catch (err) {\n      console.error(\"Erreur lors de la sauvegarde:\", err);\n      setError(\"Erreur lors de la sauvegarde des informations\");\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex justify-center items-center text-xl text-gray-700\">\n        Chargement des informations...\n      </div>\n    );\n  }\n\n  if (error || !patient) {\n    return (\n      <div className=\"min-h-screen flex flex-col justify-center items-center text-red-600\">\n        <FaExclamationCircle className=\"text-4xl mb-4\" />\n        <h2 className=\"text-xl\">{error || \"Patient introuvable.\"}</h2>\n        <button \n          onClick={() => router.back()}\n          className=\"mt-4 text-indigo-600 hover:underline\"\n        >\n          Retour\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-gray-100 min-h-screen p-6 text-black\">\n      <div className=\"max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-md\">\n        <div className=\"flex justify-between items-center mb-6\">\n          <button\n            onClick={() => router.back()}\n            className=\"flex items-center text-indigo-600 hover:underline\"\n          >\n            <FaArrowLeft className=\"mr-2\" />\n            Retour\n          </button>\n          <h1 className=\"text-2xl font-bold text-center text-indigo-700\">\n            Compléter la fiche médicale\n          </h1>\n        </div>\n\n        <form onSubmit={handleSubmit}>\n          {/* Informations de base (non modifiables) */}\n          <div className=\"mb-6 bg-gray-50 p-4 rounded-md\">\n            <h2 className=\"text-lg font-semibold text-indigo-700 mb-3\">\n              Informations de base\n            </h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-gray-700 font-medium mb-1\">Nom complet</label>\n                <input\n                  type=\"text\"\n                  value={patient.name}\n                  className=\"w-full p-2 border border-gray-300 rounded bg-gray-100 text-gray-700\"\n                  disabled\n                />\n              </div>\n              <div>\n                <label className=\"block text-gray-700 font-medium mb-1\">Âge</label>\n                <input\n                  type=\"number\"\n                  value={patient.age}\n                  className=\"w-full p-2 border border-gray-300 rounded bg-gray-100 text-gray-700\"\n                  disabled\n                />\n              </div>\n              <div className=\"md:col-span-2\">\n                <label className=\"block text-gray-700 font-medium mb-1\">Diagnostic</label>\n                <input\n                  type=\"text\"\n                  value={patient.diagnosis}\n                  className=\"w-full p-2 border border-gray-300 rounded bg-gray-100 text-gray-700\"\n                  disabled\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Informations médicales complémentaires */}\n          <div className=\"mb-6\">\n            <h2 className=\"text-lg font-semibold text-indigo-700 mb-3\">\n              Informations médicales complémentaires\n            </h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-gray-700 font-medium mb-1\">\n                  Poids (kg) <span className=\"text-gray-500 text-sm\">(optionnel)</span>\n                </label>\n                <input\n                  type=\"number\"\n                  name=\"poids\"\n                  value={patient.poids || ''}\n                  onChange={handleChange}\n                  step=\"0.1\"\n                  placeholder=\"Ex: 70.5\"\n                  className={`w-full p-2 border rounded ${\n                    formErrors.poids ? 'border-red-500' : 'border-gray-300'\n                  }`}\n                />\n                {formErrors.poids && (\n                  <p className=\"text-red-500 text-sm mt-1\">{formErrors.poids}</p>\n                )}\n              </div>\n              <div>\n                <label className=\"block text-gray-700 font-medium mb-1\">\n                  Taille (m) <span className=\"text-gray-500 text-sm\">(optionnel)</span>\n                </label>\n                <input\n                  type=\"number\"\n                  name=\"taille\"\n                  value={patient.taille || ''}\n                  onChange={handleChange}\n                  step=\"0.01\"\n                  placeholder=\"Ex: 1.75\"\n                  className={`w-full p-2 border rounded ${\n                    formErrors.taille ? 'border-red-500' : 'border-gray-300'\n                  }`}\n                />\n                {formErrors.taille && (\n                  <p className=\"text-red-500 text-sm mt-1\">{formErrors.taille}</p>\n                )}\n              </div>\n              <div className=\"md:col-span-2\">\n                <label className=\"block text-gray-700 font-medium mb-1\">\n                  Traitement en cours <span className=\"text-gray-500 text-sm\">(optionnel)</span>\n                </label>\n                <textarea\n                  name=\"traitement\"\n                  value={patient.traitement || ''}\n                  onChange={handleChange}\n                  rows={3}\n                  placeholder=\"Entrez les détails du traitement\"\n                  className=\"w-full p-2 border border-gray-300 rounded\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Informations administratives */}\n          <div className=\"mb-6\">\n            <h2 className=\"text-lg font-semibold text-indigo-700 mb-3\">\n              Informations administratives\n            </h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"md:col-span-2\">\n                <label className=\"block text-gray-700 font-medium mb-1\">\n                  Numéro de sécurité sociale <span className=\"text-gray-500 text-sm\">(optionnel)</span>\n                </label>\n                <input\n                  type=\"text\"\n                  name=\"numSecu\"\n                  value={patient.numSecu || ''}\n                  onChange={handleChange}\n                  placeholder=\"Ex: 1234567890123\"\n                  className={`w-full p-2 border rounded ${\n                    formErrors.numSecu ? 'border-red-500' : 'border-gray-300'\n                  }`}\n                />\n                {formErrors.numSecu && (\n                  <p className=\"text-red-500 text-sm mt-1\">{formErrors.numSecu}</p>\n                )}\n              </div>\n              <div className=\"md:col-span-2\">\n                <label className=\"block text-gray-700 font-medium mb-1\">\n                  Médecin traitant <span className=\"text-gray-500 text-sm\">(optionnel)</span>\n                </label>\n                <input\n                  type=\"text\"\n                  name=\"medecin\"\n                  value={patient.medecin || ''}\n                  onChange={handleChange}\n                  placeholder=\"Ex: Dr. Martin\"\n                  className=\"w-full p-2 border border-gray-300 rounded\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Message d'erreur global */}\n          {error && (\n            <div className=\"bg-red-100 text-red-700 p-3 rounded mb-4\">\n              {error}\n            </div>\n          )}\n\n          {/* Boutons d'action */}\n          <div className=\"flex justify-end space-x-4 mt-8\">\n            <button\n              type=\"button\"\n              onClick={() => router.back()}\n              className=\"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition\"\n            >\n              Annuler\n            </button>\n            <button\n              type=\"submit\"\n              disabled={saving}\n              className={`px-6 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition flex items-center ${\n                saving ? 'opacity-75 cursor-not-allowed' : ''\n              }`}\n            >\n              <FaSave className=\"mr-2\" />\n              {saving ? 'Enregistrement...' : 'Enregistrer et voir la fiche'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":"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","debugId":null}}]
}